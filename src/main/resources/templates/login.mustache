{{> layout/header}}

<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
<script type="text/javascript">
	
	Kakao.init('bd41daaf64d162d8cfc23fa90b7148f5');
	
	function kakaoLogin(){
		Kakao.Auth.loginForm({
			success: function(auth){
				
				Kakao.API.request({
					url: '/v2/user/me',
					success: function(res){
						var user = new Object();
						user.snsId = res.id;
						user.snsEmail = res.kakao_account.has_email ? res.kakao_account.email : null;
						user.snsType = "kakao";
						
						$.ajax({
							url: '/user/snslogin',
							type: 'post',
							contentType: "application/json",
							data : JSON.stringify(user),
							dataType : 'json',
							success : function(data){
								if(data.result == 'success'){
									alert('성공');
								} else if(data.result == 'nomember'){
									alert('등록된 회원이 없어 회원가입 창으로 넘어갑니다.')
									location.href = '/user/register';
								} else {
									alert('로그인에 실패하였습니다.');
								}
							}, error: function(error){
								alert('ajax 실패');
							}
						});

					},
					fail: function(err){
						alert(JSON.stringify(err));
					}
				})
			},
			fail: function(err){
				alert(JSON.stringify(err));
			}
		});
	}
</script>

<body class="bg-gradient-primary">

    <div class="container">

        <!-- Outer Row -->
        <div class="row justify-content-center">

            <div class="col-xl-10 col-lg-12 col-md-9">

                <div class="card o-hidden border-0 shadow-lg my-5">
                    <div class="card-body p-0">
                        <!-- Nested Row within Card Body -->
                        <div class="row">
                            <div class="col-lg-6 d-none d-lg-block bg-login-image"></div>
                            <div class="col-lg-6">
                                <div class="p-5">
                                    <div class="text-center">
                                        <h1 class="h4 text-gray-900 mb-4">당신은 탈모빔에 맞았습니다!</h1>
                                    </div>
                                    <form class="user">
                                        <div class="form-group">
                                            <input type="email" class="form-control form-control-user"
                                                id="inputEmail" aria-describedby="emailHelp"
                                                placeholder="이메일">
                                        </div>
                                        <div class="form-group">
                                            <input type="password" class="form-control form-control-user"
                                                id="inputPassword" placeholder="비밀번호">
                                        </div>
                                        <div class="form-group">
                                            <div class="custom-control custom-checkbox small">
                                                <input type="checkbox" class="custom-control-input" id="customCheck">
                                                <label class="custom-control-label" for="customCheck">자동 로그인</label>
                                            </div>
                                        </div>
                                        <a href="javascript:doLogin()" id="doLogin" class="btn btn-primary btn-user btn-block">
                                            로그인
                                        </a>
                                        <hr>
                                        <!-- SNS 로그인 부분 시작 -->
                                        <a class="btn btn-google btn-user btn-block" onclick="kakaoLogin()">
                                            <i class="fab fa-google fa-fw"></i> Login with Google
                                        </a>
                                        <a href="index.html" class="btn btn-facebook btn-user btn-block">
                                            <i class="fab fa-facebook-f fa-fw"></i> Login with Facebook
                                        </a>
                                        <!-- SNS 로그인 부분 끝 -->
                                    </form>
                                    <hr>
                                    <div class="text-center">
                                        <a class="small" href="/user/findpw">비밀번호 찾기</a>
                                    </div>
                                    <div class="text-center">
                                        <a class="small" href="/user/register">새 계정 만들기</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>
    
    <script type="text/javascript">
    	function doLogin(){
    		if($('#inputEmail').val() == ''){
    			alert('이메일을 입력해주세요!');
    			$('#inputEmail').focus();
    			return;
    		}
    		
    		if($('#inputPassword').val() == ''){
    			alert('비밀번호를 입력해주세요!');
    			$('#inputPassword').focus();
    			return;
    		}
    		
    		var email = $('#inputEmail').val();
    		var password = $('#inputPassword').val();
    		
    		$.ajax({
    			url: '/user/doLogin',
    			type: 'post',
    			data: {
    				email : email,
    				password : password
    			},
    			dataType: 'json',
    			success: function(data){
    				
    				
    				if(data.result == 'success'){
    					alert('로그인 되었습니다.');
    					location.href = '/';
    				} else if(data.result == 'error') {
    					alert('로그인 중 에러가 발생했습니다.');
    				} else if(data.result == 'fail') {
    					alert('이메일 또는 비밀번호가 일치하지 않습니다.');
    				} else {
    					//do something
    				}
    			},
    			error: function(err){
    				alert('AJAX 실패');
    			}	
    		});
    	}
    </script>
    
    
  {{> layout/footer}}